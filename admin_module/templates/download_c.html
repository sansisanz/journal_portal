{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>JP Admin Panel</title>

    <!-- Custom fonts for this template-->
    <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="{% static 'css/sb-admin-2.css'%}" rel="stylesheet">

</head>

<body id="page-top">

    {% include 'admin_sidebar.html' %}

    <div class="container mt-5">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="download-tab" data-toggle="tab" href="#download" role="tab" aria-controls="download" aria-selected="true">Download Page</a>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <!-- Download Page Tab -->
          <div class="tab-pane fade show active" id="download" role="tabpanel" aria-labelledby="download-tab">
            <div class="card mt-3">
              <div class="card-body">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">DOWNLOAD COUNTS</h6>
                </div><br>
                <form id="downloadForm">
                  <div class="form-row">
                      <div class="form-group col-md-3">
                          <label for="downloadDepartment">Select Department:</label>
                          <select class="form-control" id="downloadDepartment">
                              <option value="">Select Department</option>
                              {% for department in departments %}
                                  <option value="{{ department.dept_id }}">{{ department.dept_name }}</option>
                              {% endfor %}
                          </select>
                      </div>
                      <div class="form-group col-md-3">
                          <label for="downloadJournal">Select Journal:</label>
                          <select class="form-control" id="downloadJournal">
                              <option value="">Select Journal</option>
                          </select>
                      </div>
                      <div class="form-group col-md-2">
                          <label for="downloadVolume">Select Volume:</label>
                          <select class="form-control" id="downloadVolume">
                              <option value="">Select Volume</option>
                          </select>
                      </div>
                      <div class="form-group col-md-2">
                          <label for="downloadIssue">Select Issue:</label>
                          <select class="form-control" id="downloadIssue">
                              <option value="">Select Issue</option>
                          </select>
                      </div>
                      <div class="form-group col-md-2">
                          <label for="downloadArticle">Select Article:</label>
                          <select class="form-control" id="downloadArticle">
                              <option value="">Select Article</option>
                          </select>
                      </div>
                  </div>
              </form>
              <div id="downloadCount" class="mt-3 card d-none">
                  <div class="card-body">
                      <h5 class="card-title">Article Download Count</h5>
                      <p class="card-text">Total downloads: <span id="downloadCountValue">0</span></p>
                  </div>
              </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script src="{% static 'js/jquery.min.js' %}"></script>
      <script>
        $(document).ready(function() {
          $('#downloadDepartment').change(function() {
              var departmentId = $(this).val();
              if (departmentId) {
                  $.ajax({
                      url: '/get_journals_by_dept/',
                      data: {
                          'dept_id': departmentId
                      },
                      success: function(data) {
                          var journalSelect = $('#downloadJournal');
                          journalSelect.empty();
                          journalSelect.append('<option value="">Select Journal</option>');
                          $.each(data, function(index, journal) {
                              journalSelect.append('<option value="' + journal.journal_id + '">' + journal.journal_name + '</option>');
                          });
                      },
                      error: function(xhr, status, error) {
                          console.error("Error fetching journals: ", error);
                      }
                  });
              } else {
                  $('#downloadJournal').empty();
                  $('#downloadJournal').append('<option value="">Select Journal</option>');
              }
          });

          $('#downloadJournal').change(function() {
              var journalId = $(this).val();
              if (journalId) {
                  $.ajax({
                      url: '/get_volumes_by_journal/',
                      data: {
                          'journal_id': journalId
                      },
                      success: function(data) {
                          var volumeSelect = $('#downloadVolume');
                          volumeSelect.empty();
                          volumeSelect.append('<option value="">Select Volume</option>');
                          $.each(data, function(index, volume) {
                              volumeSelect.append('<option value="' + volume.volume_id + '">' + volume.volume + '</option>');
                          });
                      },
                      error: function(xhr, status, error) {
                          console.error("Error fetching volumes: ", error);
                      }
                  });
              } else {
                  $('#downloadVolume').empty();
                  $('#downloadVolume').append('<option value="">Select Volume</option>');
              }
          });

          $('#downloadVolume').change(function() {
              var volumeId = $(this).val();
              if (volumeId) {
                  $.ajax({
                      url: '/get_issues_by_volume/',
                      data: {
                          'volume_id': volumeId
                      },
                      success: function(data) {
                          var issueSelect = $('#downloadIssue');
                          issueSelect.empty();
                          issueSelect.append('<option value="">Select Issue</option>');
                          $.each(data, function(index, issue) {
                              issueSelect.append('<option value="' + issue.issue_id + '">' + issue.issue_no + '</option>');
                          });
                      },
                      error: function(xhr, status, error) {
                          console.error("Error fetching issues: ", error);
                      }
                  });
              } else {
                  $('#downloadIssue').empty();
                  $('#downloadIssue').append('<option value="">Select Issue</option>');
              }
          });

          $('#downloadIssue').change(function() {
              var issueId = $(this).val();
              if (issueId) {
                  $.ajax({
                      url: '/get_articles_by_issue/',
                      data: {
                          'issue_id': issueId
                      },
                      success: function(data) {
                          var articleSelect = $('#downloadArticle');
                          articleSelect.empty();
                          articleSelect.append('<option value="">Select Article</option>');
                          $.each(data, function(index, article) {
                              articleSelect.append('<option value="' + article.article_id + '" data-download-count="' + article.download_count + '">' + article.article_title + '</option>');
                          });
                      },
                      error: function(xhr, status, error) {
                          console.error("Error fetching articles: ", error);
                      }
                  });
              } else {
                  $('#downloadArticle').empty();
                  $('#downloadArticle').append('<option value="">Select Article</option>');
              }
          });

          $('#downloadArticle').change(function() {
              var selectedArticle = $(this).find('option:selected');
              var downloadCount = selectedArticle.data('download-count');
              if (downloadCount !== undefined) {
                  $('#downloadCountValue').text(downloadCount);
                  $('#downloadCount').removeClass('d-none');
              } else {
                  $('#downloadCount').addClass('d-none');
              }
          });
      });
  </script>   
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

  <!-- Bootstrap core JavaScript-->
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

  <!-- Core plugin JavaScript-->
  <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>

  <!-- Custom scripts for all pages-->
  <script src="{% static 'js/sb-admin-2.min.js' %}"></script>

  <!-- Page level plugins -->
  <script src="{% static 'vendor/chart.js/Chart.min.js' %}"></script>

  <!-- Page level custom scripts -->
  <script src="{% static 'js/demo/chart-area-demo.js' %}"></script>
  <script src="{% static 'js/demo/chart-pie-demo.js' %}"></script>

</body>

</html>
